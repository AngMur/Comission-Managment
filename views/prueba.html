<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Comisiones Activas - Commify</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    background: #0a0a0a;
    color: #ffffff;
    min-height: 100vh;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: #0f1e1e;
    z-index: -1;
  }

  /* Loader */
  .loader-container {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: #0f1e1e;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    animation: fadeOut 0.6s ease-out 1.5s forwards;
  }

  .loader {
    width: 60px; height: 60px;
    border: 3px solid rgba(96,166,30,0.2);
    border-top: 3px solid #60a61e;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-bottom: 16px;
  }

  .loader-text {
    color: #60a61e;
    font-size: 0.85rem;
    font-weight: 500;
    letter-spacing: 2px;
    text-transform: uppercase;
  }

  @keyframes spin { to { transform: rotate(360deg); } }
  @keyframes fadeOut { to { opacity: 0; visibility: hidden; } }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }

  /* Dashboard */
  .dashboard {
    padding: 40px 30px;
    max-width: 1400px;
    margin: 0 auto;
    opacity: 0;
    animation: fadeIn 0.6s ease-out 1.8s forwards;
  }

  /* Header */
  .header-badge {
    display: inline-block;
    background: rgba(96,166,30,0.15);
    border: 1px solid rgba(96,166,30,0.3);
    color: #60a61e;
    padding: 6px 16px;
    border-radius: 30px;
    font-size: 0.75rem;
    font-weight: 600;
    letter-spacing: 1px;
    text-transform: uppercase;
    margin-bottom: 14px;
  }

  .header-title {
    font-size: 2.4rem;
    font-weight: 800;
    background: linear-gradient(135deg, #ffffff 0%, #a0a0a0 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    letter-spacing: -1px;
    margin-bottom: 8px;
  }

  .header-date {
    color: #666;
    font-size: 0.88rem;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .header-top {
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
    margin-bottom: 36px;
    flex-wrap: wrap;
    gap: 16px;
  }

  /* Stats */
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 18px;
    margin-bottom: 36px;
  }

  .stat-card {
    background: rgba(20,20,20,0.8);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    padding: 26px;
    border: 1px solid rgba(255,255,255,0.05);
    transition: all 0.3s ease;
  }

  .stat-card:hover {
    transform: translateY(-4px);
    border-color: rgba(96,166,30,0.3);
    box-shadow: 0 10px 30px rgba(96,166,30,0.12);
  }

  .stat-icon {
    width: 46px; height: 46px;
    background: linear-gradient(135deg, rgba(96,166,30,0.15), rgba(96,166,30,0.05));
    border: 2px solid rgba(96,166,30,0.3);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    color: #60a61e;
    margin-bottom: 14px;
  }

  .stat-value {
    font-size: 1.8rem;
    font-weight: 800;
    color: #fff;
    margin-bottom: 4px;
  }

  .stat-label {
    font-size: 0.78rem;
    color: #888;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  /* Filters */
  .controls-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 14px;
    margin-bottom: 24px;
  }

  .filters-bar {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }

  .filter-btn {
    padding: 8px 18px;
    border-radius: 20px;
    border: 1px solid rgba(255,255,255,0.1);
    background: rgba(255,255,255,0.04);
    color: #888;
    font-size: 0.8rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.25s;
    letter-spacing: 0.5px;
    font-family: inherit;
  }

  .filter-btn:hover, .filter-btn.active {
    background: rgba(96,166,30,0.15);
    border-color: rgba(96,166,30,0.4);
    color: #60a61e;
  }

  /* Search */
  .search-wrap {
    display: flex;
    align-items: center;
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 12px;
    padding: 10px 16px;
    gap: 10px;
    transition: all 0.3s;
    min-width: 230px;
  }

  .search-wrap:focus-within {
    border-color: rgba(96,166,30,0.5);
    background: rgba(255,255,255,0.07);
    box-shadow: 0 0 0 3px rgba(96,166,30,0.08);
  }

  .search-wrap input {
    background: none;
    border: none;
    color: #fff;
    outline: none;
    font-size: 0.88rem;
    width: 100%;
    font-family: inherit;
  }

  .search-wrap input::placeholder { color: #555; }
  .search-wrap i { color: #555; font-size: 0.85rem; }

  /* Commissions list */
  .commissions-list {
    display: flex;
    flex-direction: column;
    gap: 14px;
  }

  /* Commission card */
  .commission-card {
    background: rgba(20,20,20,0.8);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    border: 1px solid rgba(255,255,255,0.05);
    overflow: hidden;
    transition: border-color 0.3s, box-shadow 0.3s;
    animation: fadeIn 0.4s ease both;
  }

  .commission-card:hover { border-color: rgba(96,166,30,0.18); }
  .commission-card.open {
    border-color: rgba(96,166,30,0.35);
    box-shadow: 0 8px 32px rgba(96,166,30,0.08);
  }

  /* Card header row */
  .card-header {
    padding: 22px 28px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 20px;
    user-select: none;
  }

  .card-info-grid {
    flex: 1;
    display: grid;
    grid-template-columns: 2fr 1.4fr 1.1fr 1.1fr 1.2fr 1fr;
    gap: 16px;
    align-items: center;
  }

  .info-block label {
    display: block;
    font-size: 0.65rem;
    color: #555;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    margin-bottom: 5px;
    font-weight: 600;
  }

  .info-block span {
    font-size: 0.88rem;
    color: #bbb;
    font-weight: 500;
  }

  .desarrollo-name {
    font-size: 0.98rem;
    font-weight: 700;
    color: #ffffff;
    line-height: 1.3;
  }

  .company-name {
    font-size: 0.73rem;
    color: #666;
    margin-top: 3px;
  }

  .price-text {
    font-size: 0.92rem !important;
    font-weight: 700 !important;
    color: #ffffff !important;
  }

  .commission-text {
    font-size: 0.92rem !important;
    font-weight: 700 !important;
    color: #60a61e !important;
  }

  /* Badges */
  .badge {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    padding: 5px 11px;
    border-radius: 20px;
    font-size: 0.7rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    white-space: nowrap;
  }

  .badge-dot {
    width: 6px; height: 6px;
    border-radius: 50%;
    flex-shrink: 0;
  }

  .badge-activa    { background: rgba(96,166,30,0.18);   color: #60a61e;  }
  .badge-activa .badge-dot    { background: #60a61e; }
  .badge-verificada{ background: rgba(66,153,225,0.18);  color: #4299e1;  }
  .badge-verificada .badge-dot{ background: #4299e1; }
  .badge-aprobada  { background: rgba(255,193,7,0.18);   color: #ffc107;  }
  .badge-aprobada .badge-dot  { background: #ffc107; }
  .badge-pagada    { background: rgba(76,175,80,0.18);   color: #4caf50;  }
  .badge-pagada .badge-dot    { background: #4caf50; }

  .badge-tipo {
    background: rgba(66,153,225,0.12);
    color: #4299e1;
    border: 1px solid rgba(66,153,225,0.22);
    font-size: 0.68rem;
    padding: 4px 9px;
  }

  /* Toggle chevron */
  .card-toggle {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    flex-shrink: 0;
  }

  .chevron {
    width: 32px; height: 32px;
    border-radius: 8px;
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(255,255,255,0.08);
    display: flex;
    align-items: center;
    justify-content: center;
    color: #555;
    font-size: 0.8rem;
    transition: all 0.3s;
  }

  .commission-card.open .chevron {
    transform: rotate(180deg);
    background: rgba(96,166,30,0.15);
    border-color: rgba(96,166,30,0.35);
    color: #60a61e;
  }

  .toggle-label {
    font-size: 0.65rem;
    color: #555;
    letter-spacing: 0.4px;
    white-space: nowrap;
  }

  /* Divider */
  .card-divider {
    height: 1px;
    background: rgba(255,255,255,0.05);
    margin: 0 28px;
  }

  /* Participants panel */
  .participants-panel {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.42s cubic-bezier(0.4,0,0.2,1);
  }

  .commission-card.open .participants-panel {
    max-height: 700px;
  }

  .participants-inner {
    padding: 20px 28px 26px;
  }

  .participants-title {
    font-size: 0.68rem;
    color: #60a61e;
    text-transform: uppercase;
    letter-spacing: 1.2px;
    font-weight: 700;
    margin-bottom: 14px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .participants-title i { font-size: 0.7rem; }

  .participants-title::after {
    content: '';
    flex: 1;
    height: 1px;
    background: rgba(96,166,30,0.18);
  }

  .participants-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(290px, 1fr));
    gap: 10px;
  }

  .participant-row {
    display: flex;
    align-items: center;
    gap: 13px;
    padding: 14px 16px;
    background: rgba(255,255,255,0.025);
    border: 1px solid rgba(255,255,255,0.06);
    border-radius: 14px;
    transition: all 0.25s;
  }

  .participant-row:hover {
    background: rgba(96,166,30,0.07);
    border-color: rgba(96,166,30,0.2);
  }

  .participant-avatar {
    width: 42px; height: 42px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid rgba(96,166,30,0.35);
    flex-shrink: 0;
  }

  .participant-avatar-fallback {
    width: 42px; height: 42px;
    border-radius: 50%;
    background: linear-gradient(135deg, rgba(96,166,30,0.35), rgba(74,133,24,0.35));
    border: 2px solid rgba(96,166,30,0.35);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.88rem;
    font-weight: 700;
    color: #7bc926;
    flex-shrink: 0;
  }

  .participant-info { flex: 1; min-width: 0; }

  .participant-name {
    font-size: 0.87rem;
    font-weight: 600;
    color: #e0e0e0;
    display: flex;
    align-items: center;
    gap: 7px;
    flex-wrap: wrap;
    line-height: 1.3;
  }

  .rol-tag {
    padding: 2px 8px;
    border-radius: 6px;
    font-size: 0.6rem;
    font-weight: 700;
    letter-spacing: 0.4px;
    text-transform: uppercase;
  }

  .rol-gerente { background: rgba(96,166,30,0.2);    color: #60a61e; }
  .rol-asesor  { background: rgba(66,153,225,0.18);  color: #4299e1; }
  .rol-otro    { background: rgba(159,122,234,0.18); color: #9f7aea; }

  .participant-sub {
    font-size: 0.72rem;
    color: #555;
    margin-top: 3px;
  }

  .participant-numbers { text-align: right; flex-shrink: 0; }

  .participant-monto {
    font-size: 0.93rem;
    font-weight: 700;
    color: #60a61e;
  }

  .participant-pct {
    font-size: 0.68rem;
    color: #555;
    margin-top: 3px;
  }

  /* Empty */
  .empty-state {
    text-align: center;
    padding: 70px 20px;
    color: #444;
  }

  .empty-state i {
    font-size: 2.8rem;
    margin-bottom: 16px;
    display: block;
  }

  .empty-state p { font-size: 0.9rem; }

  /* Responsive */
  @media (max-width: 1100px) {
    .card-info-grid { grid-template-columns: 2fr 1.4fr 1fr 1fr; }
    .hide-md { display: none !important; }
  }

  @media (max-width: 768px) {
    .dashboard { padding: 24px 16px; }
    .header-title { font-size: 1.8rem; }
    .card-info-grid { grid-template-columns: 1fr 1fr; gap: 12px; }
    .hide-sm { display: none !important; }
    .participants-grid { grid-template-columns: 1fr; }
    .card-header { padding: 18px 20px; }
    .participants-inner { padding: 16px 20px 22px; }
  }

  @media (max-width: 520px) {
    .card-info-grid { grid-template-columns: 1fr; }
    .controls-row { flex-direction: column; align-items: stretch; }
    .search-wrap { min-width: 0; }
  }
</style>
</head>
<body>

<!-- Loader -->
<div class="loader-container">
  <div class="loader"></div>
  <div class="loader-text">Cargando...</div>
</div>

<!-- Dashboard -->
<div class="dashboard">

  <div class="header-top">
    <div>
      <div class="header-badge">Commify</div>
      <h1 class="header-title">Comisiones de Ventas</h1>
      <div class="header-date">
        <i class="fas fa-calendar-alt"></i>
        <span id="currentDate">—</span>
      </div>
    </div>
  </div>

  <!-- Stats -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon"><i class="fas fa-file-invoice-dollar"></i></div>
      <div class="stat-value" id="statTotal">—</div>
      <div class="stat-label">Comisiones</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon"><i class="fas fa-dollar-sign"></i></div>
      <div class="stat-value" id="statMonto">—</div>
      <div class="stat-label">Monto Total</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon" style="border-color:rgba(96,166,30,0.3);background:linear-gradient(135deg,rgba(96,166,30,0.15),rgba(96,166,30,0.05))"><i class="fas fa-circle-dot" style="color:#60a61e"></i></div>
      <div class="stat-value" id="statActiva">—</div>
      <div class="stat-label">Activas</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon" style="border-color:rgba(66,153,225,0.3);background:linear-gradient(135deg,rgba(66,153,225,0.15),rgba(66,153,225,0.05))"><i class="fas fa-magnifying-glass" style="color:#4299e1"></i></div>
      <div class="stat-value" id="statVerificada">—</div>
      <div class="stat-label">Verificadas</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon" style="border-color:rgba(255,193,7,0.3);background:linear-gradient(135deg,rgba(255,193,7,0.15),rgba(255,193,7,0.05))"><i class="fas fa-thumbs-up" style="color:#ffc107"></i></div>
      <div class="stat-value" id="statAprobada">—</div>
      <div class="stat-label">Aprobadas</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon" style="border-color:rgba(76,175,80,0.3);background:linear-gradient(135deg,rgba(76,175,80,0.15),rgba(76,175,80,0.05))"><i class="fas fa-check-double" style="color:#4caf50"></i></div>
      <div class="stat-value" id="statPagada">—</div>
      <div class="stat-label">Pagadas</div>
    </div>
  </div>

  <!-- Controls -->
  <div class="controls-row">
    <div class="filters-bar" id="filtersBar">
      <button class="filter-btn active" data-filter="todas">Todas</button>
      <button class="filter-btn" data-filter="activa">Activa</button>
      <button class="filter-btn" data-filter="verificada">Verificada</button>
      <button class="filter-btn" data-filter="aprobada">Aprobada</button>
      <button class="filter-btn" data-filter="pagada">Pagada</button>
    </div>
    <div class="search-wrap">
      <i class="fas fa-search"></i>
      <input type="text" id="searchInput" placeholder="Buscar desarrollo, asesor...">
    </div>
  </div>

  <!-- List -->
  <div class="commissions-list" id="commissionsList"></div>
</div>

<script>
// ─── DATA ─────────────────────────────────────────────────────────────────────
const COMMISSIONS_DATA = [
  {
    id: 1,
    compania: "Grupo Inmobiliario Cima",
    desarrollo: "Torres Cima Residencial",
    ubicacion: "Monterrey, N.L.",
    precio: 4850000,
    tipo_comision: "% sobre venta",
    precio_venta: 4850000,
    status: "activa",
    participantes: [
      { nombre: "Laura Méndez Ortega",   rol: "Gerente", porcentaje: 3,   imagen: "https://i.pravatar.cc/80?img=47" },
      { nombre: "Ricardo Soto Villa",    rol: "Asesor",  porcentaje: 2,   imagen: "https://i.pravatar.cc/80?img=12" }
    ]
  },
  {
    id: 2,
    compania: "Desarrollos del Norte SA",
    desarrollo: "Parque Central Lofts",
    ubicacion: "San Pedro Garza García, N.L.",
    precio: 3200000,
    tipo_comision: "Comisión fija + bono",
    precio_venta: 3200000,
    status: "verificada",
    participantes: [
      { nombre: "Alejandro Ruiz Castro", rol: "Gerente", porcentaje: 2.5, imagen: "https://i.pravatar.cc/80?img=33" },
      { nombre: "Valentina Cruz López",  rol: "Asesor",  porcentaje: 1.5, imagen: "https://i.pravatar.cc/80?img=56" }
    ]
  },
  {
    id: 3,
    compania: "Vértice Desarrollos",
    desarrollo: "Vértice Punta Norte",
    ubicacion: "García, N.L.",
    precio: 6100000,
    tipo_comision: "% sobre venta",
    precio_venta: 5950000,
    status: "aprobada",
    participantes: [
      { nombre: "Mónica Garza Hernández",rol: "Gerente", porcentaje: 3,   imagen: "https://i.pravatar.cc/80?img=44" },
      { nombre: "Sergio Domínguez Reyes",rol: "Asesor",  porcentaje: 2,   imagen: "https://i.pravatar.cc/80?img=8"  }
    ]
  },
  {
    id: 4,
    compania: "Habitat Urbano",
    desarrollo: "Midtown Suites",
    ubicacion: "CDMX, Benito Juárez",
    precio: 7800000,
    tipo_comision: "% sobre venta",
    precio_venta: 7800000,
    status: "pagada",
    participantes: [
      { nombre: "Pablo Ibáñez Torres",   rol: "Gerente", porcentaje: 2.5, imagen: "https://i.pravatar.cc/80?img=19" },
      { nombre: "Fernanda Peña Solís",   rol: "Asesor",  porcentaje: 1.5, imagen: "https://i.pravatar.cc/80?img=62" }
    ]
  },
  {
    id: 5,
    compania: "Crest Inmuebles",
    desarrollo: "Crest Valle Alto",
    ubicacion: "Guadalajara, Jal.",
    precio: 2950000,
    tipo_comision: "Monto fijo",
    precio_venta: 2950000,
    status: "activa",
    participantes: [
      { nombre: "Diana Lozano Fierro",   rol: "Gerente", porcentaje: 4,   imagen: "https://i.pravatar.cc/80?img=49" },
      { nombre: "Carlos Medina Ríos",    rol: "Asesor",  porcentaje: 2,   imagen: "https://i.pravatar.cc/80?img=5"  }
    ]
  },
  {
    id: 6,
    compania: "Innova Living",
    desarrollo: "Innova Residences",
    ubicacion: "Querétaro, Qro.",
    precio: 5500000,
    tipo_comision: "% sobre venta",
    precio_venta: 5350000,
    status: "verificada",
    participantes: [
      { nombre: "Héctor Ramírez Vega",   rol: "Gerente", porcentaje: 3,   imagen: "https://i.pravatar.cc/80?img=15" },
      { nombre: "Sofía Álvarez Mora",    rol: "Asesor",  porcentaje: 2,   imagen: "https://i.pravatar.cc/80?img=39" }
    ]
  }
];

// ─── UTILS ───────────────────────────────────────────────────────────────────
const fmt  = v => v.toLocaleString('es-MX', { style:'currency', currency:'MXN', maximumFractionDigits:0 });
const fmtK = v => v >= 1e6 ? `$${(v/1e6).toFixed(1)}M` : `$${(v/1e3).toFixed(0)}K`;
const initials = n => n.split(' ').slice(0,2).map(w => w[0].toUpperCase()).join('');
const totalComision = item => item.precio_venta * (item.participantes.reduce((s,p) => s + p.porcentaje, 0) / 100);

function statusBadge(status) {
  const map = {
    activa:     { cls: 'badge-activa',     label: 'Activa'     },
    verificada: { cls: 'badge-verificada', label: 'Verificada' },
    aprobada:   { cls: 'badge-aprobada',   label: 'Aprobada'   },
    pagada:     { cls: 'badge-pagada',     label: 'Pagada'     },
  };
  const s = map[status] || { cls: 'badge-activa', label: status };
  return `<span class="badge ${s.cls}"><span class="badge-dot"></span>${s.label}</span>`;
}

function rolClass(rol) {
  const r = rol.toLowerCase();
  if (r.includes('gerente')) return 'rol-gerente';
  if (r.includes('asesor'))  return 'rol-asesor';
  return 'rol-otro';
}

function avatarHTML(p) {
  if (p.imagen) {
    const inits = initials(p.nombre);
    return `<img class="participant-avatar" src="${p.imagen}" alt="${p.nombre}"
      onerror="this.outerHTML='<div class=\\'participant-avatar-fallback\\'>${inits}</div>'">`;
  }
  return `<div class="participant-avatar-fallback">${initials(p.nombre)}</div>`;
}

// ─── RENDER CARD ─────────────────────────────────────────────────────────────
function renderCard(item, idx) {
  const comTotal = totalComision(item);
  const delay = idx * 0.055;

  const participantsHTML = item.participantes.map(p => {
    const monto = item.precio_venta * (p.porcentaje / 100);
    return `
    <div class="participant-row">
      ${avatarHTML(p)}
      <div class="participant-info">
        <div class="participant-name">
          ${p.nombre}
          <span class="rol-tag ${rolClass(p.rol)}">${p.rol}</span>
        </div>
        <div class="participant-sub">${p.porcentaje}% de comisión sobre la venta</div>
      </div>
      <div class="participant-numbers">
        <div class="participant-monto">${fmt(monto)}</div>
        <div class="participant-pct">Ganancia estimada</div>
      </div>
    </div>`;
  }).join('');

  return `
  <div class="commission-card" data-id="${item.id}" data-status="${item.status}" style="animation-delay:${delay}s">
    <div class="card-header" onclick="toggleCard(${item.id})">
      <div class="card-info-grid">
        <div class="info-block">
          <label><i class="fas fa-building" style="margin-right:3px"></i>Desarrollo</label>
          <div class="desarrollo-name">${item.desarrollo}</div>
          <div class="company-name">${item.compania}</div>
        </div>
        <div class="info-block hide-sm">
          <label><i class="fas fa-map-marker-alt" style="margin-right:3px"></i>Ubicación</label>
          <span>${item.ubicacion}</span>
        </div>
        <div class="info-block hide-sm">
          <label>Tipo de Comisión</label>
          <span class="badge badge-tipo">${item.tipo_comision}</span>
        </div>
        <div class="info-block">
          <label>Precio de Venta</label>
          <span class="price-text">${fmt(item.precio_venta)}</span>
        </div>
        <div class="info-block hide-md">
          <label>Comisión Total</label>
          <span class="commission-text">${fmt(comTotal)}</span>
        </div>
        <div class="info-block">
          <label>Estatus</label>
          ${statusBadge(item.status)}
        </div>
      </div>
      <div class="card-toggle">
        <div class="chevron"><i class="fas fa-chevron-down"></i></div>
        <span class="toggle-label">${item.participantes.length} participantes</span>
      </div>
    </div>

    <div class="card-divider"></div>

    <div class="participants-panel">
      <div class="participants-inner">
        <div class="participants-title">
          <i class="fas fa-users"></i>
          Equipo de Venta
        </div>
        <div class="participants-grid">
          ${participantsHTML}
        </div>
      </div>
    </div>
  </div>`;
}

// ─── TOGGLE ──────────────────────────────────────────────────────────────────
function toggleCard(id) {
  document.querySelector(`.commission-card[data-id="${id}"]`).classList.toggle('open');
}

// ─── STATS ───────────────────────────────────────────────────────────────────
function updateStats(data) {
  const monto = data.reduce((s, d) => s + totalComision(d), 0);
  document.getElementById('statTotal').textContent     = data.length;
  document.getElementById('statMonto').textContent     = fmtK(monto);
  document.getElementById('statActiva').textContent    = data.filter(d => d.status === 'activa').length;
  document.getElementById('statVerificada').textContent= data.filter(d => d.status === 'verificada').length;
  document.getElementById('statAprobada').textContent  = data.filter(d => d.status === 'aprobada').length;
  document.getElementById('statPagada').textContent    = data.filter(d => d.status === 'pagada').length;
}

// ─── RENDER LIST ─────────────────────────────────────────────────────────────
let allData = [];
let filtro  = 'todas';
let query   = '';

function renderList() {
  let filtered = allData;
  if (filtro !== 'todas') filtered = filtered.filter(d => d.status === filtro);
  if (query) {
    const q = query.toLowerCase();
    filtered = filtered.filter(d =>
      d.desarrollo.toLowerCase().includes(q)  ||
      d.compania.toLowerCase().includes(q)    ||
      d.ubicacion.toLowerCase().includes(q)   ||
      d.participantes.some(p => p.nombre.toLowerCase().includes(q))
    );
  }
  const list = document.getElementById('commissionsList');
  if (!filtered.length) {
    list.innerHTML = `<div class="empty-state"><i class="fas fa-folder-open"></i><p>No se encontraron comisiones</p></div>`;
    return;
  }
  list.innerHTML = filtered.map((item, i) => renderCard(item, i)).join('');
}

// ─── EVENTS ──────────────────────────────────────────────────────────────────
document.getElementById('filtersBar').addEventListener('click', e => {
  const btn = e.target.closest('.filter-btn');
  if (!btn) return;
  document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  filtro = btn.dataset.filter;
  renderList();
});

document.getElementById('searchInput').addEventListener('input', e => {
  query = e.target.value.trim();
  renderList();
});

// ─── INIT ────────────────────────────────────────────────────────────────────
async function fetchData() {
  // Reemplaza con: return (await fetch('/api/comisiones')).json();
  return new Promise(res => setTimeout(() => res(COMMISSIONS_DATA), 1200));
}

async function init() {
  document.getElementById('currentDate').textContent = new Date().toLocaleDateString('es-MX', {
    weekday:'long', year:'numeric', month:'long', day:'numeric'
  });
  allData = await fetchData();
  updateStats(allData);
  renderList();
}

init();
</script>
</body>
</html>